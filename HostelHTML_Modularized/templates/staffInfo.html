<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Staff Info</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="wrapper">
    <div class="sidebar">
        <h2>Menu</h2>
        <ul class="nav flex-column">
            <li class="nav-item"><a href="/dashboard" class="nav-link text-white">Dashboard</a></li>
            <li class="nav-item"><a href="/hosteller-info" class="nav-link text-white">Hosteller Info</a></li>
            <li class="nav-item"><a href="/staff-info" class="nav-link text-white">Staff Info</a></li>
            <li class="nav-item"><a href="/attendance-info" class="nav-link text-white">Attendance</a></li>
            <li class="nav-item"><a href="/fees-info" class="nav-link text-white">Fees Info</a></li>
        </ul>
    </div>
    <div class="main-content">
        <h1>Staff Info</h1>
        <div id="alertBox" class="alert d-none" role="alert"></div>
        <div class="card p-4 mb-4 shadow">
            <h2>Add Staff</h2>
            <form id="staffForm">
                <input type="text" class="form-control mb-2" name="staff_id" placeholder="Staff ID" required>
                <input type="text" class="form-control mb-2" name="name" placeholder="Name" required>
                <input type="text" class="form-control mb-2" name="role" placeholder="Role" required>
                <input type="number" class="form-control mb-2" name="salary" placeholder="Salary" required>
                <input type="date" class="form-control mb-2" name="date_of_joining" required>
                <input type="number" class="form-control mb-2" name="contact" placeholder="Contact" required>
                <button class="btn btn-primary" type="submit">Add Staff</button>
            </form>
        </div>
        <h2>Search Staff</h2>
        <input type="text" id="searchStaff" class="form-control mb-2" placeholder="Search by name..." onkeyup="searchStaff()">
        <input type="text" id="searchStaffID" class="form-control mb-4" placeholder="Search by staff ID..." onkeyup="searchStaffID()">
        <table class="table table-hover table-striped"><thead><tr><th>Staff ID</th><th>Name</th><th>Role</th><th>Salary</th><th>Date of Joining</th><th>Contact</th><th>Action</th></tr></thead><tbody></tbody></table>
        <button class="btn btn-secondary" onclick="loadStaff()">Refresh</button>
    </div>
</div>
<script>
    // Function to show success/error alerts
    function showAlert(message, type = 'success') {
        const alertBox = document.getElementById('alertBox');
        alertBox.className = `alert alert-${type}`;
        alertBox.innerText = message;
        alertBox.classList.remove('d-none');
        setTimeout(() => alertBox.classList.add('d-none'), 3000);
    }

    // Handle Add Staff Form Submission
    document.getElementById('staffForm').onsubmit = function(event) {
        event.preventDefault();
        const formData = new FormData(this);
        fetch('/staff', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(Object.fromEntries(formData))
        })
        .then(response => response.json())
        .then(data => {
            showAlert(data.message, data.message.includes('successfully') ? 'success' : 'danger');
            if (data.message.includes('successfully')) {
                loadStaff(); // Refresh staff table
                this.reset(); // Clear form
            }
        });
    };

    // Function to Load Staff Data
    function loadStaff() {
        fetch('/staff')
            .then(response => response.json())
            .then(data => {
                const tableBody = document.querySelector('tbody');
                tableBody.innerHTML = ''; // Clear existing rows
                data.forEach(staff => {
                    const row = `
                        <tr>
                            <td>${staff.staff_id}</td>
                            <td>${staff.name}</td>
                            <td>${staff.role}</td>
                            <td>${staff.salary}</td>
                            <td>${staff.date_of_joining}</td>
                            <td>${staff.contact}</td>
                            <td><button class="btn btn-danger btn-sm" onclick="deleteStaff('${staff.staff_id}')">Delete</button></td>
                        </tr>`;
                    tableBody.innerHTML += row;
                });
            });
    }

    // Function to Delete Staff
    function deleteStaff(staffId) {
        if (confirm('Are you sure you want to delete this staff?')) {
            fetch(`/staff/${staffId}`, { method: 'DELETE' })
                .then(response => response.json())
                .then(data => {
                    showAlert(data.message);
                    loadStaff(); // Refresh after deletion
                });
        }
    }

    // Function to Search Staff by Name
    function searchStaff() {
        const query = document.getElementById('searchStaff').value.toLowerCase();
        document.querySelectorAll('tbody tr').forEach(row => {
            const name = row.children[1].innerText.toLowerCase();
            row.style.display = name.includes(query) ? '' : 'none';
        });
    }

    // Function to Search Staff by Staff ID
    function searchStaffID() {
        const query = document.getElementById('searchStaffID').value.toLowerCase();
        document.querySelectorAll('tbody tr').forEach(row => {
            const staffID = row.children[0].innerText.toLowerCase();
            row.style.display = staffID.includes(query) ? '' : 'none';
        });
    }

    // Auto load staff data on page load
    window.onload = loadStaff;
</script>


</body>
</html>
