
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hosteller Info</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="wrapper">
    <div class="sidebar">
        <h2>Menu</h2>
        <ul class="nav flex-column">
            <li class="nav-item"><a href="/hosteller-info" class="nav-link text-white">Hosteller Info</a></li>
            <li class="nav-item"><a href="/staff-info" class="nav-link text-white">Staff Info</a></li>
            <li class="nav-item"><a href="/fees-info" class="nav-link text-white">Fees Info</a></li>
            <li class="nav-item"><a href="/attendance-info" class="nav-link text-white">Attendance</a></li>
            
        </ul>
    </div>
    <div class="main-content">
        <h1>Hosteller Info</h1>
        <div id="alertBox" class="alert d-none" role="alert"></div>
        <div class="card p-4 mb-4 shadow">
            <h2>Add Hosteller</h2>
            <form id="hostellerForm">
                <input type="text" class="form-control mb-2" name="name" placeholder="Name" required>
                <input type="number" class="form-control mb-2" name="room_no" placeholder="Room No" required>
                <input type="text" class="form-control mb-2" name="admission_no" placeholder="Admission No" required>
                <input type="date" class="form-control mb-2" name="date_of_admission" required>
                <input type="number" class="form-control mb-2" name="contact" placeholder="Contact" required>
                <button class="btn btn-primary" type="submit">Add Hosteller</button>
            </form>
        </div>
        <h2>Search Hosteller</h2>
        <input type="text" id="searchHosteller" class="form-control mb-2" placeholder="Search by name..." onkeyup="searchHosteller()">
        <input type="text" id="searchAdmission" class="form-control mb-4" placeholder="Search by admission no..." onkeyup="searchAdmission()">
        <table class="table table-hover table-striped">
            <thead><tr><th>Name</th><th>Room No</th><th>Admission No</th><th>Date of Admission</th><th>Contact</th><th>Action</th></tr></thead><tbody></tbody>
        </table>
        <button class="btn btn-secondary" onclick="loadHostellers()">Refresh</button>
    </div>
</div>
<script>
function showAlert(m, t='success'){const a=document.getElementById('alertBox');a.className=`alert alert-${t}`;a.innerText=m;a.classList.remove('d-none');setTimeout(()=>a.classList.add('d-none'),3000);}
document.getElementById('hostellerForm').onsubmit = function(e) {
    e.preventDefault();
    
    // Get form data
    let formData = Object.fromEntries(new FormData(this));

    // Debugging: Check if "status" is mistakenly included
    console.log("Form Data:", formData);

    fetch('/hosteller', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(formData)  // Send JSON to backend
    })
    .then(response => response.json())
    .then(data => {
        showAlert(data.message, data.message.includes('successfully') ? 'success' : 'danger');
        loadHostellers();
        this.reset();
    });
};

function loadHostellers(){fetch('/hostellers').then(r=>r.json()).then(data=>{const tbody=document.querySelector('tbody');tbody.innerHTML='';data.forEach(h=>tbody.innerHTML+=`<tr><td>${h.name}</td><td>${h.room_no}</td><td>${h.admission_no}</td><td>${h.date_of_admission}</td><td>${h.contact}</td><td><button class="btn btn-danger btn-sm" onclick="deleteHosteller(${h.hosteller_id})">Delete</button></td></tr>`);});}
function deleteHosteller(id){if(confirm("Are you sure?"))fetch('/hosteller/'+id,{method:'DELETE'}).then(r=>r.json()).then(d=>{showAlert(d.message);loadHostellers();});}
function searchHosteller(){const q=document.getElementById('searchHosteller').value.toLowerCase();document.querySelectorAll('tbody tr').forEach(r=>r.style.display=r.children[0].innerText.toLowerCase().includes(q)?'':'none');}
function searchAdmission(){const q=document.getElementById('searchAdmission').value.toLowerCase();document.querySelectorAll('tbody tr').forEach(r=>r.style.display=r.children[2].innerText.toLowerCase().includes(q)?'':'none');}
window.onload=loadHostellers;
</script>
</body>
</html>
